" =============================================
" æ’ä»¶
" =============================================

"Plug 'preservim/nerdtree'
set NERDTree

" ================================================================================================
" ğŸ‘»ğŸ‘»ğŸ‘» Which-Key ğŸ‘»ğŸ‘»ğŸ‘»
" ================================================================================================
set which-key
set notimeout
let g:WhichKey_FontSize = 16

" =============================================
" åŸºç¡€é…ç½®
" =============================================

" è®¾ç½®å­—ä½“
set guifont = Intel\ One\ Mono\ Light:h12

"--å°†æœç´¢åŒ¹é…çš„æ–‡æœ¬é«˜äº®æ˜¾ç¤º
set hlsearch

"--é€’å¢æœç´¢åŠŸèƒ½ï¼šåœ¨æ‰§è¡Œæœç´¢ï¼ˆä½¿ç”¨ / æˆ– ? å‘½ä»¤ï¼‰æ—¶ï¼Œ
"Vim ä¼šåœ¨æ‚¨è¾“å…¥æœç´¢æ¨¡å¼çš„è¿‡ç¨‹ä¸­é€æ­¥åŒ¹é…å¹¶é«˜äº®æ˜¾ç¤ºåŒ¹é…çš„æ–‡æœ¬ã€‚
set incsearch

"--åœ¨æœç´¢æ—¶å¿½ç•¥å¤§å°å†™
set ignorecase
set smartcase
set showmode

"--å½“å‰è¡Œçš„ç»å¯¹è¡Œå·
set number

"--è®¾ç½®ç›¸å¯¹è¡Œå·
set relativenumber

"è®¾ç½®åœ¨å…‰æ ‡è·ç¦»çª—å£é¡¶éƒ¨æˆ–åº•éƒ¨ä¸€å®šè¡Œæ•°æ—¶ï¼Œå¼€å§‹æ»šåŠ¨å±å¹•å†…å®¹çš„è¡Œä¸º
set scrolloff=3
set history=1000

" ç³»ç»Ÿå‰ªè´´æ¿
set clipboard=unnamed

"--è®¾ç½®è¿”å›normalæ¨¡å¼æ—¶å›åˆ°è‹±æ–‡è¾“å…¥æ³•
set keep-english-in-normal

" =============================================
" é Leader é”®è®¾ç½®
" =============================================

" ä¿å­˜æ–‡ä»¶ Ctrl+s
inoremap <c-s> <Esc>:w<cr>
nnoremap <c-s> <Esc>:w<cr>

" æ¢å¤/Redo
nmap U <c-r>

"--æ™®é€šæ¨¡å¼ä¸‹ä½¿ç”¨å›è½¦é”®ï¼Œå‘ä¸‹/å‘ä¸Š å¢åŠ ä¸€è¡Œ
"nmap <CR> o<Esc>
"nmap <S-Enter> O<Esc>

"--å°† jj å’Œ jk æ˜ å°„ä¸º <Esc>, å¿«é€Ÿé€€å‡ºæ’å…¥æ¨¡å¼
imap jj <Esc>
"imap jk <Esc>
vmap i <Esc>

"å°†Ctrl + s æ˜ å°„ä¸ºä¿å­˜æ–‡æ¡£(ä¹Ÿå¯ä»¥åœ¨VIMè®¾ç½®é‡Œå°†æ­¤å¿«æ·é”®è®¾ç½®ä¸ºIDEAçš„å¿«æ·é”®)
nmap <C-S> :action SaveAll<cr>
imap <C-S> <Esc>:actionã€€SaveAll<cr>

" è¡Œé¦–è¡Œå°¾ç§»åŠ¨
map H ^
map L $
" å—é—´ç§»åŠ¨
map J }
map K {


" =============================================
" Leader é”®è®¾ç½®
" =============================================

" <leader>é”®è®¾ç½®ï¼ˆæœ¬é…ç½®ä¸ºç©ºæ ¼é”®)
let mapleader=' '

" View mode
let g:WhichKeyDesc_ViewMode= "<leader>v ViewMode"
" å…¨å±æ¨¡å¼
map <leader>vf <Action>(ToggleFullScreen)
" å…æ‰“æ‰°æ¨¡å¼
map <leader>vv <Action>(ToggleDistractionFreeMode)
" æ¼”ç¤ºæ¨¡å¼
map <leader>vp <Action>(TogglePresentationMode)

" buffer (buffer < window < tab)
" å…³é—­é¡µç­¾æ“ä½œ
let g:WhichKeyDesc_CloseTable = "<leader>x CloseTable"
" å…³é—­å½“å‰é¡µç­¾
nmap <leader>xx <Action>(CloseContent)
" å…³é—­æ‰€æœ‰é¡µç­¾
nmap <leader>xa <Action>(CloseAllEditors)
" å…³é—­å…¶ä»–é¡µç­¾
nmap <leader>xo <Action>(CloseAllEditorsButActive)
" å…³é—­å›ºå®šé¡µç­¾
nmap <leader>xp <Action>(CloseAllUnpinnedEditors)

" window
" åˆ‡æ¢æ ‡ç­¾é¡µ
" <A-Right>
nmap <C-Tab> <Action>(PreviousTab)
nmap <Tab> <Action>(NextTab)
" å›ºå®š/å–æ¶ˆå›ºå®š é¡µç­¾
nmap <leader>p <Action>(PinActiveEditorTab)


" =============================================
" åˆ†å±æ“ä½œ
" =============================================
let g:WhichKeyDesc_SplitTab = "<leader>S SplitTab"
map <leader>Sh <Action>(MoveTabLeft)
map <leader>Sj <Action>(MoveTabDown)
map <leader>Sk <Action>(MoveTabUp)
map <leader>Sl <Action>(MoveTabRight)
map <leader>SH <Action>(SplitHorizontally)
map <leader>SV <Action>(SplitVertically)

" åˆ†å±ä¹‹é—´è·³è½¬æ“ä½œ
"nmap <C-p> <Action>(JumpToLastWindow)
nmap <M-i> <Action>(PrevSplitter)
nmap <M-o> <Action>(NextSplitter)
" çª—å£é—´è·³è½¬
nmap <C-k> <C-w>k
nmap <C-j> <C-w>j
nmap <C-h> <C-w>h
nmap <C-l> <C-w>l


" =============================================
" Goto
" =============================================

" æ–¹æ³•é—´ç§»åŠ¨ (Move between methods)
map [f <Action>(MethodUp)
map ]f <Action>(MethodDown)

" å‰è¿›/åé€€
nmap <C-i> <Action>(Back)
nmap <C-o> <Action>(Forward)

" <C-U> è·³è½¬åˆ°ä¸Šçº§æ–¹æ³•
map gu <Action>(GotoSuperMethod)
" <A-C-B> è·³è½¬åˆ°å£°æ˜/è·³è½¬åˆ°å®ç°ç±»
map gi <Action>(GotoImplementation)
" <C-B> è·³è½¬åˆ°å£°æ˜
map gd <Action>(GotoDeclaration)
map gt <Action>(GotoTest)
" F2 è·³è½¬åˆ°ä¸‹ä¸€ä¸ªé”™è¯¯æˆ–è­¦å‘Š
map ge <Action>(GotoNextError)
map gE <Action>(GotoPreviousError)
" <c-q> å¿«é€Ÿæ–‡æ¡£
map gh <Action>(QuickJavaDoc)
" å¿«é€Ÿæ“ä½œ
map gH <Action>(QuickActions)
" é‡æ„èœå•
map gr <Action>(RefactoringMenu)
" æ˜¾ç¤ºæ„å›¾/Alt+Enter
map ga <Action>(ShowIntentionActions)
" æ˜¾ç¤ºä½¿ç”¨
map gf <Action>(ShowUsages)
" æŸ¥æ‰¾ä½¿ç”¨/Alt+F7
map gF <Action>(FindUsages)

" =============================================
" Code
" =============================================

" ä»£ç ä¸Šä¸‹ç§»åŠ¨è¡Œ (Move line up/down)
map <M-k> <Action>(MoveLineUp)
map <M-j> <Action>(MoveLineDown)

" ä»£ç æŠ˜å /å±•å¼€ (Code fold/expand)
map zm <Action>(CollapseRegion)
map za <Action>(ExpandRegion)
" æŠ˜å /å±•å¼€æ‰€æœ‰
map zM <Action>(CollapseAllRegions)
map zR <Action>(ExpandAllRegions)

" æ³¨é‡Š (Comment)
map gc <Action>(CommentByLineComment)

"nnoremap <leader>k <Esc>:echo 'test keymap'<cr>

" ===================== Extract/æå– ========================

let g:WhichKeyDesc_Extract = "<leader>e Extract"
" extract method/function å°†ä»£ç æå–ä¸ºä¸€ä¸ªç‹¬ç«‹çš„æ–¹æ³•(Ctrl + Alt + M)
vmap <leader>em :action ExtractMethod<cr>

" extract constant å¼•å…¥å¸¸é‡(Ctrl + Alt + C)
vmap <leader>ec :action IntroduceConstant<cr>

" extract field ï¼ˆå¼•å…¥å­—æ®µï¼‰çš„é‡æ„æ“ä½œ:å°†é€‰ä¸­çš„ä»£ç ç‰‡æ®µè½¬åŒ–ä¸ºä¸€ä¸ªæ–°çš„å­—æ®µï¼Œå¹¶è‡ªåŠ¨å°†é€‰ä¸­çš„ä»£ç ç‰‡æ®µæ›¿æ¢ä¸ºå¯¹è¯¥å­—æ®µçš„å¼•ç”¨(Ctrl + Alt + F)
vmap <leader>ef :action IntroduceField<cr>

" extract variable ï¼ˆå¼•å…¥å˜é‡ï¼‰çš„é‡æ„æ“ä½œ:å°†é€‰ä¸­çš„ä»£ç ç‰‡æ®µæŠ½å–ä¸ºä¸€ä¸ªæ–°çš„å˜é‡ï¼Œå¹¶è‡ªåŠ¨æ›¿æ¢é€‰ä¸­çš„ä»£ç ç‰‡æ®µä¸ºæ–°çš„å˜é‡å¼•ç”¨(Ctrl + Alt + V)
vmap <leader>ev :action IntroduceVariable<cr>


" ===================== Search/æœç´¢ ========================
let g:WhichKeyDesc_Search = "<leader>s Search"

" æœç´¢æ‰€æœ‰/ ç›¸å½“äºIDEAçš„ä¸¤æ¬¡shiftæŒ‰é’®
nnoremap <Leader>sa :action SearchEverywhere<CR>
" è·³è½¬åˆ°æ“ä½œ
map <leader>sA <Action>(GotoAction)
" è·³è½¬åˆ°ç±»
map <leader>sc <Action>(GotoClass)
" è·³è½¬åˆ°ç¬¦å·
map <leader>ss <Action>(GotoSymbol)
" <C-S-F> è·³è½¬åˆ°æ–‡ä»¶
map <leader>sf <Action>(GotoFile)

" åœ¨æ–‡ä»¶ä¸­æŸ¥æ‰¾
nnoremap<Leader>sF :action FindInPath<CR>

" (vimè‡ªå¸¦çš„æœç´¢)
nnoremap / /

" æ¸…é™¤é«˜äº®
nnoremap <BS><BS> :noh<cr>

" ===================== easymotion è®¾ç½® ========================
" easymotion è®¾ç½®
set easymotion

" easymotion è®¾ç½® ä¸¤å­—ç¬¦æœç´¢
nmap <leader><leader>s <Plug>(easymotion-s2)


" ===================== Goto/è·³è½¬ ========================

" <c-F12> æ–‡ä»¶ç»“æ„
nnoremap <c-BS> :action FileStructurePopup<CR>

" ideaå†…ç½®å¿«æ·é”®alt+F1 (ä½¿ç”¨å¿«æ·é”® ç©ºæ ¼+m)
nnoremap <Leader>m :action SelectIn<CR>

" ===================== Buffer Action ========================

let g:WhichKeyDesc_BufAction = "<leader>b BufAction"
" <c-f> æŸ¥æ‰¾
nnoremap <leader>bf :action Find<CR>

" <c-r> æ›¿æ¢
nnoremap <leader>br :action Replace<CR>

" é‡å‘½åå…ƒç´ 
nmap <leader>bn <Action>(RenameElement)

" æœ€è¿‘æ‰“å¼€çš„æ–‡ä»¶åˆ—è¡¨
nmap <leader>be <Action>(RecentFiles)

" æœ€è¿‘ç¼–è¾‘çš„æ–‡ä»¶åˆ—è¡¨
map <leader>bc <Action>(RecentChangedFiles)

" <C-A> å…¨é€‰
"nnoremap ca :action $SelectAll<cr>
nnoremap <leader>ba gg V G<cr>

" <c-w> é€‰ä¸­å•è¯
"nnoremap <leader>cw :action EditorSelectWord<CR>

" ===================== æµè§ˆå¿«æ·é”® ========================

" javadoc <c-q>
"nnoremap cq :action QuickJavaDoc<cr>

" ===================== ç»ˆç«¯ (Terminal) ========================
let g:WhichKeyDesc_Terminal = "<leader>t Terminal"
" æ‰“å¼€ç»ˆç«¯å¹¶è¿›å…¥é¡¹ç›®æ ¹ç›®å½• (ActivateTerminal with project root dir)
map <leader>tt <Action>(ActivateTerminalToolWindow)
" æ‰“å¼€ç»ˆç«¯å¹¶è¿›å…¥å½“å‰ç›®å½• (OpenTerminal with current dir)
map <leader>tc <Action>(Terminal.OpenInTerminal)

" ===================== Run/è¿è¡Œ ========================
let g:WhichKeyDesc_RunAction = "<leader>r RunAction"
" <C-S-F10> è¿è¡Œå½“å‰ç±»
nnoremap <Leader>rr :action RunClass<CR>

" <S-F10> è¿è¡Œå½“å‰æ–‡ä»¶
nnoremap <Leader>ru :action Run<CR>

" ===================== æ’ä»¶ ========================

" NERDTree è®¾ç½®
" å¼€å¯/å…³é—­æ–‡ä»¶æ ‘
nnoremap <leader>O :NERDTreeToggle<CR>

" å½“å‰æ–‡ä»¶æ˜¾ç¤ºåœ¨æ–‡ä»¶æ ‘ä¸­
nnoremap <leader>V :NERDTreeFind<CR>